[
    {
        "content": "<p>Oops, I have another token requirement that isn't covered in Backdrop: [current-page:node:field_myfield]</p>",
        "id": 211785754,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601483045
    },
    {
        "content": "<p>Could [current-page:query:?] be a workaround?</p>",
        "id": 211785877,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601483117
    },
    {
        "content": "<p>And if so, how does it work? Never used so far.</p>",
        "id": 211785906,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601483137
    },
    {
        "content": "<p>Wouldn't module entity_token provide these? I'm almost sure.</p>",
        "id": 211873432,
        "sender_full_name": "indigoxela",
        "timestamp": 1601534034
    },
    {
        "content": "<p>Oh yes, probably, thank you, I'll have a look! (Seems I have to install 3 modules then: Entity, Entity Plus, and Entity Token.)</p>",
        "id": 211889584,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601546812
    },
    {
        "content": "<p>(Ah, Entity is part of Backdrop core, so only 2 modules.)</p>",
        "id": 211891709,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601548325
    },
    {
        "content": "<blockquote>\n<p>Wouldn't module entity_token provide these?</p>\n</blockquote>\n<p>Nope! I've installed <a href=\"https://github.com/backdrop-contrib/entity_token\">https://github.com/backdrop-contrib/entity_token</a>, but the <code>current:page</code> tokens are the same as before. No field related ones.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/backdrop-contrib/entity_token\" style=\"background-image: url(https://avatars1.githubusercontent.com/u/7720679?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/backdrop-contrib/entity_token\" title=\"backdrop-contrib/entity_token\">backdrop-contrib/entity_token</a></div><div class=\"message_embed_description\">Provides token replacements for all properties that have no tokens and are known to the entity API. - backdrop-contrib/entity_token</div></div></div>",
        "id": 211891985,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601548557
    },
    {
        "content": "<p>I suppose, you can't use <code>[node:field_whatever]</code>?</p>",
        "id": 211893085,
        "sender_full_name": "indigoxela",
        "timestamp": 1601549406
    },
    {
        "content": "<p>Unfortunately not, I'm embedding the Webform (as node reference, rendered entity) in another content item which holds the field in question.</p>",
        "id": 211893726,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601549884
    },
    {
        "content": "<p>Hm... Is it in a custom layout? I'm asking because you could use a custom layout context and then render the field in a layout region. (Probably not what you need, just a quick idea.) Is it a single webform or do you need something dynamic for multiple?</p>",
        "id": 211894261,
        "sender_full_name": "indigoxela",
        "timestamp": 1601550211
    },
    {
        "content": "<p>No, it isn't a custom layout. Also, it's quite complicated: I need the field value in the <em>description</em> text of a webform component:</p>\n<p>[ ] Ich möchte an der Veranstaltung teilnehmen und überweise den Eintrittspreis innerhalb einer Woche auf das Konto ...<br>\n<em>Eintrittspreise: [current-page:node:field_programm_eintritt]. Die Kontodaten senden wir Ihnen per E-Mail.</em></p>",
        "id": 211894669,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601550501
    },
    {
        "content": "<p>Works in the D7 site, I guess due to Entity tokens (which however doesn't do the trick in Backdrop).</p>",
        "id": 211895021,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601550778
    },
    {
        "content": "<p>I've also found another approach for D7 (patch in <a href=\"https://www.drupal.org/node/919760#comment-9973163\">https://www.drupal.org/node/919760#comment-9973163</a>), but in Backdrop I don't find the place where the patch would apply.</p>",
        "id": 211895154,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601550868
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"256738\">@indigoxela</span> Do you think it's more easy to write a custom token specifically for this use case instead?</p>",
        "id": 211895216,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601550929
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"256674\">@Olaf Grabienski</span> I've written custom tokens myself before. Its quite easy and very powerful.</p>",
        "id": 211895469,
        "sender_full_name": "BWPanda",
        "timestamp": 1601551101
    },
    {
        "content": "<p>Sounds like you have a fairly unique situation that a custom token would work nicely for.</p>",
        "id": 211895506,
        "sender_full_name": "BWPanda",
        "timestamp": 1601551142
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"256607\">@BWPanda</span> sounds reasonable! Only, as usual, above my skills without further indications. At first sight, I've no idea how the code for this token would look like.</p>",
        "id": 211895709,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601551297
    },
    {
        "content": "<p>The other token I wrote recently (<a href=\"#narrow/stream/218635-Backdrop/topic/Random.20token/near/211779508\">https://backdrop.zulipchat.com/#narrow/stream/218635-Backdrop/topic/Random.20token/near/211779508</a>) was more a copy &amp; paste thing.</p>",
        "id": 211895845,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601551409
    },
    {
        "content": "<p>Yep, so just need to implement <code>hook_token_info()</code> and <code>hook_tokens()</code>.</p>",
        "id": 211895985,
        "sender_full_name": "BWPanda",
        "timestamp": 1601551546
    },
    {
        "content": "<p>Well, the \"just implement\" part is the crucial one for me !-)</p>",
        "id": 211896102,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601551626
    },
    {
        "content": "<p>The one I did recently was a token that output the name of a species. This was taken from a term reference field and a textfield on the node, and another optional textfield. Would it help to share that code, or not really?</p>",
        "id": 211896193,
        "sender_full_name": "BWPanda",
        "timestamp": 1601551695
    },
    {
        "content": "<p>Another option is that you spin up a Tugboat demo site on <a href=\"http://BackdropCMS.org\">BackdropCMS.org</a>, then set it up the way you need (webform, fields, etc.), share it with me and I can try writing the token code to match that setup...</p>",
        "id": 211896477,
        "sender_full_name": "BWPanda",
        "timestamp": 1601551942
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"256607\">@BWPanda</span> Sounds both interesting ... Have to leave for an hour and will check in again then.</p>",
        "id": 211896550,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601552023
    },
    {
        "content": "<p>Ok, well while I have it open then, here's my custom token code:</p>\n<div class=\"codehilite\" data-code-language=\"PHP\"><pre><span></span><code><span class=\"x\">/**</span>\n<span class=\"x\"> * Implements hook_token_info().</span>\n<span class=\"x\"> */</span>\n<span class=\"x\">function surg_token_info() {</span>\n<span class=\"x\">  return array(</span>\n<span class=\"x\">    'types' =&gt; array(</span>\n<span class=\"x\">      'species' =&gt; array(</span>\n<span class=\"x\">        'name' =&gt; t('Species'),</span>\n<span class=\"x\">        'description' =&gt; t('Tokens related to Species nodes.'),</span>\n<span class=\"x\">        'needs-data' =&gt; 'node',</span>\n<span class=\"x\">      ),</span>\n<span class=\"x\">    ),</span>\n<span class=\"x\">    'tokens' =&gt; array(</span>\n<span class=\"x\">      'species' =&gt; array(</span>\n<span class=\"x\">        'title' =&gt; array(</span>\n<span class=\"x\">          'name' =&gt; t('Title'),</span>\n<span class=\"x\">          'description' =&gt; t('The title of the Species node.'),</span>\n<span class=\"x\">          'type' =&gt; 'node',</span>\n<span class=\"x\">        ),</span>\n<span class=\"x\">      ),</span>\n<span class=\"x\">    ),</span>\n<span class=\"x\">  );</span>\n<span class=\"x\">}</span>\n\n<span class=\"x\">/**</span>\n<span class=\"x\"> * Implements hook_tokens().</span>\n<span class=\"x\"> */</span>\n<span class=\"x\">function surg_tokens($type, $tokens, array $data = array(), array $options = array()) {</span>\n<span class=\"x\">  $langcode = isset($options['language']) ? $options['language']-&gt;langcode : LANGUAGE_NONE;</span>\n<span class=\"x\">  $sanitize = !empty($options['sanitize']);</span>\n<span class=\"x\">  $replacements = array();</span>\n\n<span class=\"x\">  if ($type == 'species' &amp;&amp; !empty($node = $data['node'])) {</span>\n<span class=\"x\">    foreach ($tokens as $name =&gt; $original) {</span>\n<span class=\"x\">      if ($name == 'title') {</span>\n<span class=\"x\">        // Create a title of the form: 'GENUS SPECIES [(NOTATION)]'.</span>\n<span class=\"x\">        $genus = taxonomy_term_load($node-&gt;field_genus[$langcode][0]['tid']);</span>\n<span class=\"x\">        $title = $genus-&gt;name . ' ' . $node-&gt;field_species[$langcode][0]['value'];</span>\n<span class=\"x\">        if (!empty($notation = $node-&gt;field_notation[$langcode][0]['value'])) {</span>\n<span class=\"x\">          $title .= ' (' . $notation . ')';</span>\n<span class=\"x\">        }</span>\n\n<span class=\"x\">        $replacements[$original] = $sanitize ? filter_xss($title) : $title;</span>\n<span class=\"x\">      }</span>\n<span class=\"x\">    }</span>\n<span class=\"x\">  }</span>\n\n<span class=\"x\">  return $replacements;</span>\n<span class=\"x\">}</span>\n</code></pre></div>",
        "id": 211896945,
        "sender_full_name": "BWPanda",
        "timestamp": 1601552289
    },
    {
        "content": "<p>I first create a token type called 'Species' which holds all the tokens (in this case just 1) for my Species nodes (and it requires 'node' data to work properly). I then create a token in the Species group called 'title' which I will use as my Species node titles (I did all this because in D7 I was using custom PHP code in auto nodetitle, which isn't available in Backdrop since the PHP module was (rightly) removed).<br>\nSo that's the <code>hook_token_info()</code> implementation.</p>",
        "id": 211897197,
        "sender_full_name": "BWPanda",
        "timestamp": 1601552492
    },
    {
        "content": "<p>Now for the token code itself (in <code>hook_tokens()</code>:<br>\nI make sure I'm only dealing with 'Species' tokens where node data is available. Then, for each token (again, in this case just 'title') I generate the title based on the different node field values. I get the term ID from the term reference field, and use it to load the full term, where I add the term name to the beginning of my title. Then I add the value of my Species textfield. Finally, if the Notation field has a value, I append it in brackets on the end. I then add that to the array and return it.</p>",
        "id": 211897628,
        "sender_full_name": "BWPanda",
        "timestamp": 1601552778
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"256607\">@BWPanda</span> Thank you for sharing the code, very kind! I've still difficulties to connect the dots. (Never learned PHP, and in the rare cases I need it, I'm usually short of time, so learning from these examples didn't happen most of the times.)</p>\n<p>However, I have set up a Tugboat site with a simplified example of my use case. You can already have a quick look at an example Event: <a href=\"https://1-17-1-0qtn4ndjcnnqarovkgm1o2t6moadh6dh.tugboat.qa/event/barbecue\">https://1-17-1-0qtn4ndjcnnqarovkgm1o2t6moadh6dh.tugboat.qa/event/barbecue</a>. (The goal is to render the \"Admission fee\" value of the Event node in the \"Confirmation\" component of the webform at the bottom of the page.)</p>",
        "id": 211907000,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601557989
    },
    {
        "content": "<p>If you want, I can add a user account for you. Which email address?</p>",
        "id": 211907105,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601558042
    },
    {
        "content": "<p>Just a friendly reminder: although I appreciate the help efforts to get things done quickly, long term there should be bug report issues filed for things that work in D7 whereas not in Backdrop (whether core or contrib). We should make it easy as possible for people upgrading from D7 to do the same things ...if things don't work, then \"Backdrop is broken\".</p>",
        "id": 211927944,
        "sender_full_name": "klonos",
        "timestamp": 1601566049
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"256729\">@klonos</span> This one <em>doesn't</em> work in D7, or only with Entity tokens. But you're right, in Backdrop with Entity tokens it doesn't work either.</p>",
        "id": 211928524,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601566264
    },
    {
        "content": "<p>However, Entity tokens is beta, and it seems to be buggy anyways. At least, I wasn't able to save a node after installing it. Unfortunately, I've just not the time to dig deeper in this case and gave up with this approach for the time being.</p>",
        "id": 211928850,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601566407
    },
    {
        "content": "<p>Voilà, filed a bug report for the missing Random tokens: <a href=\"https://github.com/backdrop/backdrop-issues/issues/4672\">https://github.com/backdrop/backdrop-issues/issues/4672</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/backdrop/backdrop-issues/issues/4672\" style=\"background-image: url(https://avatars3.githubusercontent.com/u/5283039?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/backdrop/backdrop-issues/issues/4672\" title=\"Random tokens are missing · Issue #4672 · backdrop/backdrop-issues\">Random tokens are missing · Issue #4672 · backdrop/backdrop-issues</a></div><div class=\"message_embed_description\">Description of the bug Drupal 7 (with the Token module installed) provides &quot;Random&quot; tokens like [random:number]. Backdrop has integrated tokens but without Random tokens. They should be a...</div></div></div>",
        "id": 211930365,
        "sender_full_name": "Olaf Grabienski",
        "timestamp": 1601566994
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"256674\">@Olaf Grabienski</span> ++</p>",
        "id": 211935918,
        "sender_full_name": "klonos",
        "timestamp": 1601569311
    },
    {
        "content": "<p>grabienski** Cheers (Karma: 14)</p>",
        "id": 211935919,
        "sender_full_name": "Dragonbot",
        "timestamp": 1601569311
    }
]