[
    {
        "content": "<p>Hi guys, usually for my other drupal sites I have a script for fixing automatically the file permissions in the server. Do we have something similar for backdrop? Specifically I manually changed the permissions and ownership of some files making them the same as in drupal but I got this error when I tried to save the configuration of the language icons module</p>\n<p>Error<br>\nFailed to write configuration file: ./files/config_51ad21e943ab2ce097d2ac3a6fcb670e/active/languageicons.settings.json <br>\n<a href=\"/user_uploads/18319/_60mBiWkhHzCPMgBop_blZgd/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/18319/_60mBiWkhHzCPMgBop_blZgd/image.png\" title=\"image.png\"><img src=\"/user_uploads/18319/_60mBiWkhHzCPMgBop_blZgd/image.png\"></a></div><p>What is the correct ownership and permissions for the backdrop structure?</p>",
        "id": 231139522,
        "sender_full_name": "cptX",
        "timestamp": 1616238218
    },
    {
        "content": "<p>I use the same permissions for Drupal 7 &amp; Backdrop</p>",
        "id": 231139614,
        "sender_full_name": "BWPanda",
        "timestamp": 1616238335
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>find [ROOT] -type d -execdir chmod u=rwx,g=rxs,o= &quot;{}&quot; \\;\nfind [ROOT] -type f -execdir chmod u=rwX,g=r,o= &quot;{}&quot; \\;\n\nfind [ROOT]/files -type d -execdir chmod u=rwx,g=rwxs,o= &quot;{}&quot; \\;\nfind [ROOT]/files -type f -execdir chmod u=rw,g=rw,o= &quot;{}&quot; \\;\n</code></pre></div>",
        "id": 231139721,
        "sender_full_name": "BWPanda",
        "timestamp": 1616238480
    },
    {
        "content": "<p>OK thanks, as I am the owner of the whole file structure and the www-data is the group, I needed to give g+w rights to make it work. Now it's ok, although I would like to know the opinion of the others regarding a script that would automatically take care of this. </p>\n<p>Would the following script for drupal 6 be ok for backdrop?</p>",
        "id": 231139758,
        "sender_full_name": "cptX",
        "timestamp": 1616238487
    },
    {
        "content": "<p>This is my script for Drupal 6</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"ch\">#!/bin/bash</span>\n\n<span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"p\">%/</span><span class=\"si\">}</span>\n<span class=\"nv\">user</span><span class=\"o\">=</span><span class=\"si\">${</span><span class=\"nv\">2</span><span class=\"si\">}</span>\n<span class=\"nv\">group</span><span class=\"o\">=</span><span class=\"s2\">&quot;www-data&quot;</span>\n<span class=\"nv\">help</span><span class=\"o\">=</span><span class=\"s2\">&quot;\\nHelp: This script is used to fix permissions of a drupal installation\\nyou need to provide the following arguments:\\n\\t 1) Path to your drupal installation\\n\\t 2) Username of the user that you want to give files/directories ownership\\nNote: \\&quot;www-data\\&quot; (apache default) is assumed as the group the server is belonging to, if this is different you need to modify it manually by editing this script\\n\\nUsage: (sudo) bash </span><span class=\"si\">${</span><span class=\"nv\">0</span><span class=\"p\">##*/</span><span class=\"si\">}</span><span class=\"s2\"> drupal_path user_name\\n&quot;</span>\n\n<span class=\"k\">if</span> <span class=\"o\">[</span> -z <span class=\"s2\">&quot;</span><span class=\"si\">${</span><span class=\"nv\">path</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span> <span class=\"o\">]</span> <span class=\"o\">||</span> <span class=\"o\">[</span> ! -d <span class=\"s2\">&quot;</span><span class=\"si\">${</span><span class=\"nv\">path</span><span class=\"si\">}</span><span class=\"s2\">/sites&quot;</span> <span class=\"o\">]</span> <span class=\"o\">||</span> <span class=\"o\">[</span> ! -f <span class=\"s2\">&quot;</span><span class=\"si\">${</span><span class=\"nv\">path</span><span class=\"si\">}</span><span class=\"s2\">/modules/system/system.module&quot;</span> <span class=\"o\">]</span><span class=\"p\">;</span> <span class=\"k\">then</span>\n<span class=\"nb\">echo</span> <span class=\"s2\">&quot;Please provide a valid drupal path&quot;</span>\n<span class=\"nb\">echo</span> -e <span class=\"nv\">$help</span>\n<span class=\"nb\">exit</span>\n<span class=\"k\">fi</span>\n\n<span class=\"k\">if</span> <span class=\"o\">[</span> -z <span class=\"s2\">&quot;</span><span class=\"si\">${</span><span class=\"nv\">user</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span> <span class=\"o\">]</span> <span class=\"o\">||</span> <span class=\"o\">[</span> <span class=\"s2\">&quot;`id -un </span><span class=\"si\">${</span><span class=\"nv\">user</span><span class=\"si\">}</span><span class=\"s2\"> 2&gt; /dev/null`&quot;</span> !<span class=\"o\">=</span> <span class=\"s2\">&quot;</span><span class=\"si\">${</span><span class=\"nv\">user</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span> <span class=\"o\">]</span><span class=\"p\">;</span> <span class=\"k\">then</span>\n<span class=\"nb\">echo</span> <span class=\"s2\">&quot;Please provide a valid user&quot;</span>\n<span class=\"nb\">echo</span> -e <span class=\"nv\">$help</span>\n<span class=\"nb\">exit</span>\n<span class=\"k\">fi</span>\n\n<span class=\"nb\">cd</span> <span class=\"nv\">$path</span><span class=\"p\">;</span>\n\n<span class=\"nb\">echo</span> -e <span class=\"s2\">&quot;Changing ownership of all contents of \\&quot;</span><span class=\"si\">${</span><span class=\"nv\">path</span><span class=\"si\">}</span><span class=\"s2\">\\&quot; :\\n user =&gt; \\&quot;</span><span class=\"si\">${</span><span class=\"nv\">user</span><span class=\"si\">}</span><span class=\"s2\">\\&quot; \\t group =&gt; \\&quot;</span><span class=\"si\">${</span><span class=\"nv\">group</span><span class=\"si\">}</span><span class=\"s2\">\\&quot;\\n&quot;</span>\nchown -R <span class=\"si\">${</span><span class=\"nv\">user</span><span class=\"si\">}</span>:<span class=\"si\">${</span><span class=\"nv\">group</span><span class=\"si\">}</span> .\n<span class=\"nb\">echo</span> <span class=\"s2\">&quot;Changing permissions of all directories inside \\&quot;</span><span class=\"si\">${</span><span class=\"nv\">path</span><span class=\"si\">}</span><span class=\"s2\">\\&quot; to \\&quot;750\\&quot;...&quot;</span>\nfind . -type d -exec chmod <span class=\"nv\">u</span><span class=\"o\">=</span>rwx,g<span class=\"o\">=</span>rx,o<span class=\"o\">=</span> <span class=\"o\">{}</span> <span class=\"se\">\\;</span>\n<span class=\"nb\">echo</span> -e <span class=\"s2\">&quot;Changing permissions of all files inside \\&quot;</span><span class=\"si\">${</span><span class=\"nv\">path</span><span class=\"si\">}</span><span class=\"s2\">\\&quot; to \\&quot;640\\&quot;...\\n&quot;</span>\nfind . -type f -exec chmod <span class=\"nv\">u</span><span class=\"o\">=</span>rw,g<span class=\"o\">=</span>r,o<span class=\"o\">=</span> <span class=\"o\">{}</span> <span class=\"se\">\\;</span>\n\n<span class=\"nb\">cd</span> <span class=\"nv\">$path</span>/sites<span class=\"p\">;</span>\n\n<span class=\"nb\">echo</span> <span class=\"s2\">&quot;Changing permissions of \\&quot;files\\&quot; directories in \\&quot;</span><span class=\"si\">${</span><span class=\"nv\">path</span><span class=\"si\">}</span><span class=\"s2\">/sites\\&quot; to \\&quot;770\\&quot;...&quot;</span>\nfind . -type d -name files -exec chmod <span class=\"nv\">ug</span><span class=\"o\">=</span>rwx,o<span class=\"o\">=</span> <span class=\"s1\">&#39;{}&#39;</span> <span class=\"se\">\\;</span>\n<span class=\"nb\">echo</span> <span class=\"s2\">&quot;Changing permissions of all files inside all \\&quot;files\\&quot; directories in \\&quot;</span><span class=\"si\">${</span><span class=\"nv\">path</span><span class=\"si\">}</span><span class=\"s2\">/sites\\&quot; to \\&quot;660\\&quot;...&quot;</span>\nfind . -name files -type d -exec find <span class=\"s1\">&#39;{}&#39;</span> -type f <span class=\"se\">\\;</span> <span class=\"p\">|</span> <span class=\"k\">while</span> <span class=\"nb\">read</span> FILE<span class=\"p\">;</span> <span class=\"k\">do</span> chmod <span class=\"nv\">ug</span><span class=\"o\">=</span>rw,o<span class=\"o\">=</span> <span class=\"s2\">&quot;</span><span class=\"nv\">$FILE</span><span class=\"s2\">&quot;</span><span class=\"p\">;</span> <span class=\"k\">done</span>\n<span class=\"nb\">echo</span> <span class=\"s2\">&quot;Changing permissions of all directories inside all \\&quot;files\\&quot; directories in \\&quot;</span><span class=\"si\">${</span><span class=\"nv\">path</span><span class=\"si\">}</span><span class=\"s2\">/sites\\&quot; to \\&quot;770\\&quot;...&quot;</span>\nfind . -name files -type d -exec find <span class=\"s1\">&#39;{}&#39;</span> -type d <span class=\"se\">\\;</span> <span class=\"p\">|</span> <span class=\"k\">while</span> <span class=\"nb\">read</span> DIR<span class=\"p\">;</span> <span class=\"k\">do</span> chmod <span class=\"nv\">ug</span><span class=\"o\">=</span>rwx,o<span class=\"o\">=</span> <span class=\"s2\">&quot;</span><span class=\"nv\">$DIR</span><span class=\"s2\">&quot;</span><span class=\"p\">;</span> <span class=\"k\">done</span>\n</code></pre></div>",
        "id": 231139908,
        "sender_full_name": "cptX",
        "timestamp": 1616238673
    },
    {
        "content": "<p>If you have a Backdrop multisite setup, that should work. But if you have a single site in a Backdrop installation, then the files dir is <code>[ROOT]/files</code>, not <code>[ROOT]/sites/[SITE]/files</code>...</p>",
        "id": 231140140,
        "sender_full_name": "BWPanda",
        "timestamp": 1616239000
    },
    {
        "content": "<p>Good point!</p>",
        "id": 231140222,
        "sender_full_name": "cptX",
        "timestamp": 1616239127
    },
    {
        "content": "<p>Here's the script I use if it helps:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"ch\">#!/bin/bash</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># Peter's secure file permissions script.</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># Based on: https://drupal.org/node/244924</span>\n\n<span class=\"c1\"># Setup variables.</span>\n<span class=\"nv\">user</span><span class=\"o\">=[</span>USER<span class=\"o\">]</span>\n<span class=\"nv\">group</span><span class=\"o\">=</span>www-data\n<span class=\"nv\">files_paths</span><span class=\"o\">=</span>sites/*/files\n\n<span class=\"c1\"># Secure file permissions for the given directories.</span>\nsecure<span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"nv\">cms_path</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"nv\">$@</span><span class=\"s2\">\"</span>\n\n        <span class=\"c1\"># Change permissions for directories and files.</span>\n        chown -R <span class=\"nv\">$user</span>:<span class=\"nv\">$group</span> <span class=\"nv\">$cms_path</span>\n        find <span class=\"nv\">$cms_path</span> -type d -execdir chmod <span class=\"nv\">u</span><span class=\"o\">=</span>rwx,g<span class=\"o\">=</span>rxs,o<span class=\"o\">=</span> <span class=\"s2\">\"{}\"</span> <span class=\"se\">\\+</span>\n        find <span class=\"nv\">$cms_path</span> -type f -execdir chmod <span class=\"nv\">u</span><span class=\"o\">=</span>rwX,g<span class=\"o\">=</span>r,o<span class=\"o\">=</span> <span class=\"s2\">\"{}\"</span> <span class=\"se\">\\+</span>\n\n        <span class=\"c1\"># Change permissions for root `files` directory.</span>\n        <span class=\"k\">if</span> <span class=\"o\">[</span> -d <span class=\"nv\">$cms_path</span>/files <span class=\"o\">]</span>\n        <span class=\"k\">then</span>\n                find <span class=\"nv\">$cms_path</span>/files -type d -execdir chmod <span class=\"nv\">u</span><span class=\"o\">=</span>rwx,g<span class=\"o\">=</span>rwxs,o<span class=\"o\">=</span> <span class=\"s2\">\"{}\"</span> <span class=\"se\">\\+</span>\n                find <span class=\"nv\">$cms_path</span>/files -type f -execdir chmod <span class=\"nv\">u</span><span class=\"o\">=</span>rw,g<span class=\"o\">=</span>rw,o<span class=\"o\">=</span> <span class=\"s2\">\"{}\"</span> <span class=\"se\">\\+</span>\n        <span class=\"k\">fi</span>\n\n        <span class=\"c1\"># Change permissions for sites `files` directory.</span>\n        <span class=\"k\">if</span> <span class=\"o\">[</span> -d <span class=\"nv\">$cms_path</span>/sites <span class=\"o\">]</span>\n        <span class=\"k\">then</span>\n                <span class=\"k\">for</span> files_path <span class=\"k\">in</span> <span class=\"nv\">$cms_path</span>/<span class=\"nv\">$files_paths</span>\n                <span class=\"k\">do</span>\n                        find <span class=\"nv\">$files_path</span> -type d -execdir chmod <span class=\"nv\">u</span><span class=\"o\">=</span>rwx,g<span class=\"o\">=</span>rwxs,o<span class=\"o\">=</span> <span class=\"s2\">\"{}\"</span> <span class=\"se\">\\+</span>\n                        find <span class=\"nv\">$files_path</span> -type f -execdir chmod <span class=\"nv\">u</span><span class=\"o\">=</span>rw,g<span class=\"o\">=</span>rw,o<span class=\"o\">=</span> <span class=\"s2\">\"{}\"</span> <span class=\"se\">\\+</span>\n                <span class=\"k\">done</span>\n        <span class=\"k\">fi</span>\n<span class=\"o\">}</span>\n\n<span class=\"c1\"># Secure Backdrop &amp; Drupal.</span>\nsecure /var/www/backdrop1\nsecure /var/www/drupal7\n</code></pre></div>",
        "id": 231140227,
        "sender_full_name": "BWPanda",
        "timestamp": 1616239131
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 231140426,
        "sender_full_name": "cptX",
        "timestamp": 1616239351
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"256607\">@BWPanda</span> do we have all that documented anywhere? (the dos/api site ideally)</p>",
        "id": 231201164,
        "sender_full_name": "klonos",
        "timestamp": 1616313772
    },
    {
        "content": "<p>This page maybe? <a href=\"https://backdropcms.org/file-permissions-and-ownership\">https://backdropcms.org/file-permissions-and-ownership</a> To be honest I just made the script from the Drupal link at the top if my script. But I believe the <a href=\"http://B.org\">B.org</a> page is a copy of that one...</p>",
        "id": 231203287,
        "sender_full_name": "BWPanda",
        "timestamp": 1616316957
    },
    {
        "content": "<p>...so does <code>drush fix-permissions</code> basically do all that? ^^ (it should)</p>",
        "id": 231212557,
        "sender_full_name": "klonos",
        "timestamp": 1616328546
    },
    {
        "content": "<p>Basically, yes: <a href=\"https://github.com/backdrop-contrib/backdrop-drush-extension/blob/1.x-1.x/commands/devops/fix-permissions.sh\">https://github.com/backdrop-contrib/backdrop-drush-extension/blob/1.x-1.x/commands/devops/fix-permissions.sh</a></p>\n<p>However I use my own script because:</p>\n<ul>\n<li>Drush doesn't look like it handles Backdrop's root 'files' dir properly...?</li>\n<li>I set the 'setgid' permission on my directories (<a href=\"https://en.m.wikipedia.org/wiki/Setuid\">https://en.m.wikipedia.org/wiki/Setuid</a>)</li>\n<li>I use the uppercase 'X' for conditional execution</li>\n</ul>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/backdrop-contrib/backdrop-drush-extension/blob/1.x-1.x/commands/devops/fix-permissions.sh\" style=\"background-image: url(https://avatars.githubusercontent.com/u/7720679?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/backdrop-contrib/backdrop-drush-extension/blob/1.x-1.x/commands/devops/fix-permissions.sh\" title=\"backdrop-contrib/backdrop-drush-extension\">backdrop-contrib/backdrop-drush-extension</a></div><div class=\"message_embed_description\">A set of commands and boot class for Drush and Backdrop CMS. - backdrop-contrib/backdrop-drush-extension</div></div></div>",
        "id": 231237935,
        "sender_full_name": "BWPanda",
        "timestamp": 1616357118
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"256607\">@BWPanda</span> <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span> <br>\nThere you go <span class=\"user-mention\" data-user-id=\"390119\">@cptX</span> ...if you have drush + <a href=\"https://github.com/backdrop-contrib/backdrop-drush-extension\">https://github.com/backdrop-contrib/backdrop-drush-extension</a> installed on your server, then you can use the <code>drush fix-permissions</code> command <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/backdrop-contrib/backdrop-drush-extension\" style=\"background-image: url(https://avatars.githubusercontent.com/u/7720679?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/backdrop-contrib/backdrop-drush-extension\" title=\"backdrop-contrib/backdrop-drush-extension\">backdrop-contrib/backdrop-drush-extension</a></div><div class=\"message_embed_description\">A set of commands and boot class for Drush and Backdrop CMS. - backdrop-contrib/backdrop-drush-extension</div></div></div>",
        "id": 231242216,
        "sender_full_name": "klonos",
        "timestamp": 1616362009
    },
    {
        "content": "<p>Thank you all for your answers!</p>",
        "id": 231280564,
        "sender_full_name": "cptX",
        "timestamp": 1616404472
    },
    {
        "content": "<p>By the way why should we install the backdrop-drush-extension in order to use drush? In drupal 6 I haven't installed any module, just used drush directly</p>",
        "id": 231280669,
        "sender_full_name": "cptX",
        "timestamp": 1616404535
    },
    {
        "content": "<p>Drush is built for Drupal and, as such, many of the commands don't 'just work' for Backdrop. So the Backdrop Drush Extension (BDE) was created to bridge the gap between Drush and Backdrop. On my server, I have both D7 sites and Backdrop sites. I have Drush installed, which works for D7, and the BDE which works for Backdrop. Because BDE is an <em>extension</em> of Drush, there's no conflict and you can run both simultaneously. However some commands need to be prefixed with 'backdrop', such as <code>backdrop-config-import</code> (or <code>bcim</code>).</p>",
        "id": 231282077,
        "sender_full_name": "BWPanda",
        "timestamp": 1616405376
    },
    {
        "content": "<p>Yes but I read in this module description that this will work only with a specific drush version. Isn't that a significant limitation if you have other drupal sites installed?<br>\nAlso I think there is also brush, does this work without the module and has all the functionality drush provides?</p>",
        "id": 231282377,
        "sender_full_name": "cptX",
        "timestamp": 1616405532
    },
    {
        "content": "<p>Ah yes. Backdrop's Drush requires Drush 8.x I believe. This is one of the limitations of Backdrop's Drush, and is one of the reasons Brush and Bee exist. Brush is more 'feature-complete', supporting most of the commands Drush does, while Bee was written specifically for Backdrop and so currently lacks many of Drush's features, but aims to become the de-facto standard and ultimately replace Drush/Brush for Backdrop sites.</p>",
        "id": 231282716,
        "sender_full_name": "BWPanda",
        "timestamp": 1616405705
    }
]